name: ü§ñ Validador de Acciones Compuestas

on:
  pull_request:
    branches: [ main ]

jobs:
  validate-action:
    runs-on: ubuntu-latest

    steps:
      # 1. Obtener el c√≥digo de la PR del estudiante
      - name: Obtener el c√≥digo de la PR
        uses: actions/checkout@v4
        with:
          ref: ${{ github.event.pull_request.head.sha }}

      # 2. Ejecutar la ACCI√ìN que el estudiante cre√≥
      # Esta es la parte clave: 'uses' apunta a la carpeta
      # que el estudiante cre√≥ EN SU RAMA.
      - name: Ejecutar la acci√≥n del estudiante
        id: student-action # Le damos un ID para leer su salida
        uses: ./_actions/log-analyzer # ¬°Usa la acci√≥n de la PR!
        with:
          log-file: 'data/log-produccion.txt' # Le pasamos el log de prueba

      # 3. Validar la salida de la acci√≥n del estudiante
      - name: Validar el resultado
        run: |
          # El n√∫mero esperado de errores en el log es 3
          EXPECTED_COUNT="3"
          # Obtenemos la salida de la acci√≥n del estudiante
          ACTUAL_COUNT="${{ steps.student-action.outputs.error-count }}"

          echo "Salida de la acci√≥n del estudiante: $ACTUAL_COUNT"

          if [ "$ACTUAL_COUNT" != "$EXPECTED_COUNT" ]; then
            echo "‚ùå Fallo: Se esperaban $EXPECTED_COUNT errores, pero tu acci√≥n report√≥ $ACTUAL_COUNT."
            exit 1
          else
            echo "‚úÖ ¬°√âxito! Tu acci√≥n cont√≥ los errores correctamente."
          fi
